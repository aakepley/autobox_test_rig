# pipeline data run locations
pipelineDir = [
    # cycle 4 12 benchmarks
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2016.1.00484.L_2017_10_18T14_56_42.619/SOUS_uid___A001_Xbd4641_X1e/GOUS_uid___A001_Xbd4641_X22/MOUS_uid___A001_Xbd4641_X23/working/pipeline-20171018T161546',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2016.1.00565.S_2017_09_21T19_36_22.299/SOUS_uid___A001_X87c_X451/GOUS_uid___A001_X87c_X452/MOUS_uid___A001_X87c_X453/working/pipeline-20170921T203637',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2015.1.00827.S_2017_10_16T13_00_53.514/SOUS_uid___A001_X2fb_X110/GOUS_uid___A001_X2fb_X111/MOUS_uid___A001_X2fb_X112/working/pipeline-20171016T154503',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2016.1.00859.S_2017_09_25T13_01_50.878/SOUS_uid___A001_X87c_X61a/GOUS_uid___A001_X87c_X61b/MOUS_uid___A001_X87c_X61c/working/pipeline-20170925T133221',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2016.1.00970.S_2017_10_17T12_59_53.565/SOUS_uid___A001_X879_X1cd/GOUS_uid___A001_X879_X1ce/MOUS_uid___A001_X879_X1cf/working/pipeline-20171017T142059',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2016.1.01269.S_2017_09_25T19_58_22.702/SOUS_uid___A001_X87d_Xc79/GOUS_uid___A001_X87d_Xc7a/MOUS_uid___A001_X87d_Xc7b/working/pipeline-20170925T205947',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2016.1.01400.S_2017_09_22T15_04_25.685/SOUS_uid___A001_X88f_X24e/GOUS_uid___A001_X88f_X24f/MOUS_uid___A001_X88f_X250/working/pipeline-20170922T165208',               
    # cycle 4 7m benchmarks
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2016.1.00063.S_2017_10_18T16_39_26.936/SOUS_uid___A001_X879_X6cd/GOUS_uid___A001_X879_X6ce/MOUS_uid___A001_X879_X6d1/working/pipeline-20171018T203055',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2016.1.00577.S_2017_10_19T13_25_46.694/SOUS_uid___A001_X87c_X107/GOUS_uid___A001_X87c_X108/MOUS_uid___A001_X87c_X10d/working/pipeline-20171019T155046',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2016.1.00747.S_2017_09_26T14_03_07.711/SOUS_uid___A001_X879_X422/GOUS_uid___A001_X879_X423/MOUS_uid___A001_X879_X426/working/pipeline-20170926T190612',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2016.1.00782.S_2017_10_25T21_09_41.725/SOUS_uid___A001_X87c_X819/GOUS_uid___A001_X87c_X81a/MOUS_uid___A001_X87c_X81d/working/pipeline-20171025T214258',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2016.1.00875.S_2017_10_19T13_29_49.068/SOUS_uid___A001_X88f_X124/GOUS_uid___A001_X88f_X125/MOUS_uid___A001_X88f_X128/working/pipeline-20171019T161036',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2016.1.00912.S_2017_09_22T15_04_36.605/SOUS_uid___A001_X885_X3fb/GOUS_uid___A001_X885_X3fc/MOUS_uid___A001_X885_X3ff/working/pipeline-20170922T164116',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2016.1.00121.S_2017_10_20T11_41_28.068/SOUS_uid___A001_X88a_X5/GOUS_uid___A001_X88a_X6/MOUS_uid___A001_X88a_Xb/working/pipeline-20171020T133735',
    # cycle 3 12m benchmarks
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2015.A.00005.S_2017_09_26T14_04_44.816/SOUS_uid___A002_Xad2d3f_X15/GOUS_uid___A002_Xad2d3f_X16/MOUS_uid___A002_Xad2d3f_X17/working/pipeline-20170926T154615',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2015.1.00131.S_2017_09_26T01_03_04.615/SOUS_uid___A001_X2fa_X185/GOUS_uid___A001_X2fa_X186/MOUS_uid___A001_X2fa_X187/working/pipeline-20170926T013947',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2015.1.00137.S_2017_09_20T17_31_30.945/SOUS_uid___A002_Xac065b_X46/GOUS_uid___A002_Xac065b_X47/MOUS_uid___A002_Xac065b_X48/working/pipeline-20170920T200924',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2015.1.00150.S_2017_09_20T17_31_40.855/SOUS_uid___A001_X2f6_X263/GOUS_uid___A001_X2f6_X264/MOUS_uid___A001_X2f6_X265/working/pipeline-20170920T181839',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2015.1.00633.S_2017_09_26T12_46_40.540/SOUS_uid___A001_X2f7_X1e7/GOUS_uid___A001_X2f7_X1e8/MOUS_uid___A001_X2f7_X1eb/working/pipeline-20170926T131654',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2015.1.00956.S_2017_09_20T17_31_55.500/SOUS_uid___A001_X2fb_X2b7/GOUS_uid___A001_X2fb_X2b8/MOUS_uid___A001_X2fb_X2b9/working/pipeline-20170920T193845',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2015.1.01068.S_2017_09_26T17_45_18.579/SOUS_uid___A001_X2fa_Xec/GOUS_uid___A001_X2fa_Xed/MOUS_uid___A001_X2fa_Xf0/working/pipeline-20170926T210740',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2015.1.01084.S_2017_10_16T18_11_47.813/SOUS_uid___A001_X2fa_X1fa/GOUS_uid___A001_X2fa_X1fb/MOUS_uid___A001_X2fa_X1fc/working/pipeline-20171016T185105',
    # Cycle 3 7m benchmarks
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2015.1.00190.S_2017_09_20T17_31_58.043/SOUS_uid___A001_X2fe_X112/GOUS_uid___A001_X2fe_X113/MOUS_uid___A001_X2fe_X116/working/pipeline-20170920T191717',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2015.1.00665.S_2017_10_17T12_59_43.510/SOUS_uid___A001_X2d8_X2c1/GOUS_uid___A001_X2d8_X2c2/MOUS_uid___A001_X2d8_X2c5/working/pipeline-20171017T133524',
    '/lustre/naasc/sciops/comm/sbooth/pipeline/root/5.1.0_validation/2015.1.00956.S_2017_09_28T20_44_42.962/SOUS_uid___A001_X2fb_X2b7/GOUS_uid___A001_X2fb_X2b8/MOUS_uid___A001_X2fb_X2bb/working/pipeline-20170928T221653'
]

# output directory
outDir = '/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/data/'

# what pipeline stages we are interested in.
#stages = [29,31,33] 
stages = [18]

import test_rig

for pDir in pipelineDir:
    test_rig.extractDataFromPipeline(pDir,outDir,stages=stages)

dPir = '/lustre/naasc/sciops/comm/rindebet/pipeline/root/2017.1.00370.S_2018_07_21T15_48_59.392/SOUS_uid___A001_X1273_X498/GOUS_uid___A001_X1273_X499/MOUS_uid___A001_X1273_X49a/working/pipeline-20180721T164006'

test_rig.extractDataFromPipeline(dPir,outDir,stages=[31,33,35])

outDir = '/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/data/'

test_rig.setupTest(outDir,'/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/base_speed')
test_rig.setupTest(outDir,'/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/prune_speedup')
test_rig.setupTest(outDir,'/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/grow_speedup')
test_rig.setupTest(outDir,'/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/stop_mask')
test_rig.setupTest(outDir,'/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/negative_threshold')
test_rig.setupTest(outDir,'/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/stop_mask_nocondition2')
test_rig.setupTest(outDir,'/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/prerelease')
test_rig.setupTest(outDir,'/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/new_noise')
test_rig.setupTest(outDir,'/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/new_noise_nonzeroloc')



test_rig.setupTest(outDir,'/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/minpercentchange')


test_rig.setupRobustTest(outDir,'/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/robust_p2_test',robust=2,ptsPerBeam=5.0)

test_rig.setupRobustTest(outDir,'/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/robust_p2_ptsPerBeam3_test',robust=2,ptsPerBeam=3.0)

test_rig.setupRobustTest(outDir,'/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/robust_n05_test',robust=-0.5,ptsPerBeam=5.0)


test_rig.createBatchScript('/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/base_speed','/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/base_speed/casa-feature-CAS-10758-1.el6')

test_rig.createBatchScript('/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/prune_speedup','/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/prune_speedup/casa-feature-CAS-10758-3.el6')

test_rig.createBatchScript('/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/grow_speedup','/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/grow_speedup/casa-feature-CAS-10758-9.el6')

test_rig.createBatchScript('/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/stop_mask','/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/stop_mask/casa-feature-CAS-10758-16.el6')


## DONE
test_rig.createBatchScript('/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/robust_p2_test','/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/grow_speedup/casa-feature-CAS-10758-9.el6')

## MOSTLY RUN
test_rig.createBatchScript('/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/robust_p2_ptsPerBeam3_test','/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/grow_speedup/casa-feature-CAS-10758-9.el6')

##  Mostly Run
test_rig.createBatchScript('/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/robust_n05_test','/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/grow_speedup/casa-feature-CAS-10758-9.el6')




test_rig.createBatchScript('/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/negative_threshold','/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/negative_threshold/casa-feature-CAS-10758-13.el6')

test_rig.createBatchScript('/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/stop_mask_nocondition2','/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/stop_mask/casa-feature-CAS-10758-20.el6')

test_rig.createBatchScript('/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/prerelease','')

test_rig.createBatchScript('/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/new_noise','/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/rms_test/casa_test_v2/casa-test-CAS-11216-3.el6')

test_rig.createBatchScript('/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/new_noise_nonzeroloc','/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/new_noise_nonzeroloc/casa-test-CAS-11216-5.el6')


# To submit batch processing to the cluster.
# /lustre/naasc/users/jrobnett/alma-pipeline/bin/batch_pipe.sh -m 245 ./pipelinerun


## Adding Remy's really waffly data set.

dPir = '/lustre/naasc/sciops/comm/rindebet/pipeline/root/2017.1.00370.S_2018_07_21T15_48_59.392/SOUS_uid___A001_X1273_X498/GOUS_uid___A001_X1273_X499/MOUS_uid___A001_X1273_X49a/working/pipeline-20180721T164006'

test_rig.extractDataFromPipeline(dPir,outDir,stages=[31,33,35])

outDir = '/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/data/'

test_rig.setupTest(outDir,'/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/minpercentchange')


test_rig.createBatchScript('/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/minpercentchange','')





outDir = '/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/data/'

test_rig.setupNewParameterTest(outDir,'/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/noGrowPrune','dogrowprune=False','nogrowprune')


test_rig.createBatchScript('/lustre/naasc/sciops/comm/akepley/pl/autobox/casa5.3_dev/speed_tests/noGrowPrune','')


testparam = (('robust',2),('niter',5),('interactive',1),('dogrowprune',False))
test_rig.modifyParameters('2015.1.00131.S_2017_09_26T01_03_04.615.py','junk.py',testparam)
